{% extends 'layout.html' %}

{% import "components/gallery/gallery.njk" as galleryPreviewPanel %}

{% block script %}
  {% include "control/blogItem.js" %}
  {% include "components/gallery/gallery.js" %}
{% endblock script %}

{% block css%}
  {% include "components/gallery/gallery.css" %}
  {% include "style/blogItem.css" %}
{% endblock css%}

{% block onload %}
  {% for section in item.sections %}
    {% if section.type == "gallery" %}
      createGalleryPreviewPanel("gallery-{{loop.index}}");
    {%endif%}
  {%endfor%}
{% endblock onload %}

{% macro renderHeader(data) %}
  <h2 class="text-invert">{{data}}</h2>
{% endmacro %}

{% macro renderText(data) %}
  <h3 class="text-invert">{{data | escape | nl2br}}</h3>
{% endmacro %}

{% macro renderMedia(data) %}
  {% if data.type == "image"%}
    <div class="media-item" type="{{data.type}}" id="{{data.id}}" style="background-image:url(/image/{{data.id}}?=1080)"></div>
  {% elif data.type == "video" %}
    <div class="media-item" type="{{data.type}}" id="{{data.id}}">
      <iframe src="{{ data.src }}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe>
    </div>
  {%endif%}
{% endmacro %}

{% block content %}
  <div id="blog-item" class="panel">
    <h1 class="robo-text">Blog Item</h1>
    <div class="blog-item-layout">
      <h1 id="caption" class="text-invert">{{item.caption}}</h1>
      <br />
      {% for section in item.sections %}
        {% if section.type == "header" %}
          {{ renderHeader(section.data) }}
          <br />
        {% elif section.type == "text" %}
          {{ renderText(section.data) }}
          <br />
        {% elif section.type == "media" %}
          {{ renderMedia(section.data) }}
          <br />
        {% elif section.type == "gallery" %}
          {{ galleryPreviewPanel.render("gallery-" + loop.index, section.data) }}
          <br />
        {%endif%}
      {%endfor%}
      <br />
    </div>
  </div>
{% endblock content %}